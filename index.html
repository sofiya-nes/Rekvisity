<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Оплата адвокату</title>
    <style>
        /* Стили для уведомлений и кнопок */
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        .fallback-menu {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            z-index: 1001;
            text-align: center;
        }
        
        .fallback-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <!-- Остальная часть страницы -->
    
    <div class="notification" id="notification"></div>
    
    <div class="fallback-menu" id="fallback-menu">
        <h3>Не удалось открыть приложение</h3>
        <p>Выберите действие:</p>
        <button class="fallback-btn" id="open-browser">Открыть веб-версию банка</button>
        <button class="fallback-btn" id="copy-details">Скопировать реквизиты</button>
        <button class="fallback-btn" id="close-fallback">Закрыть</button>
    </div>

    <script>
        // Объект с deeplinks для банков
        const bankApps = {
            sber: {
                name: "Сбербанк",
                deeplink: "sberbank://transfer?bic=047501711&account=40703810707120000397",
                web: "https://online.sberbank.ru"
            },
            vtb: {
                name: "ВТБ",
                deeplink: "vtb24://transfer?bic=047501711&account=40703810707120000397",
                web: "https://online.vtb.ru"
            },
            tinkoff: {
                name: "Тинькофф",
                deeplink: "tinkoff://pay?bik=047501711&accountNumber=40703810707120000397",
                web: "https://www.tinkoff.ru"
            }
        };

        // Элементы интерфейса
        const notification = document.getElementById('notification');
        const fallbackMenu = document.getElementById('fallback-menu');
        const openBrowserBtn = document.getElementById('open-browser');
        const copyDetailsBtn = document.getElementById('copy-details');
        const closeFallbackBtn = document.getElementById('close-fallback');
        
        // Текущий выбранный банк
        let currentBank = null;
        
        // Функция для показа уведомления
        function showNotification(message, isError = false) {
            notification.textContent = message;
            notification.style.background = isError ? '#f44336' : '#4CAF50';
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Основная функция открытия приложения
        function openBankApp(bankId) {
            const bank = bankApps[bankId];
            if (!bank) return;
            
            currentBank = bank;
            let appOpened = false;
            
            // 1. Попытка открытия через iframe (для iOS)
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = bank.deeplink;
            document.body.appendChild(iframe);
            
            // 2. Прямой переход (для Android)
            setTimeout(() => {
                window.location.href = bank.deeplink;
            }, 100);
            
            // 3. Отслеживаем успешное открытие
            window.addEventListener('blur', () => {
                appOpened = true;
            });
            
            // 4. Проверка через 500 мс
            setTimeout(() => {
                if (!appOpened) {
                    showNotification(`Не удалось открыть ${bank.name}`, true);
                    showFallbackMenu();
                }
            }, 500);
        }
        
        // Показать меню fallback
        function showFallbackMenu() {
            if (!currentBank) return;
            fallbackMenu.style.display = 'block';
        }
        
        // Скрыть меню fallback
        function hideFallbackMenu() {
            fallbackMenu.style.display = 'none';
        }
        
        // Обработчики для кнопок меню
        openBrowserBtn.addEventListener('click', () => {
            if (currentBank && currentBank.web) {
                window.open(currentBank.web, '_blank');
            }
            hideFallbackMenu();
        });
        
        copyDetailsBtn.addEventListener('click', () => {
            const details = `БИК: 047501711\nСчет: 40703810707120000397\nНазначение: Адвокату Несмияновой МП`;
            navigator.clipboard.writeText(details).then(() => {
                showNotification('Реквизиты скопированы!');
            });
            hideFallbackMenu();
        });
        
        closeFallbackBtn.addEventListener('click', hideFallbackMenu);
        
        // Инициализация кнопок банков
        document.querySelectorAll('.bank-card').forEach(card => {
            card.addEventListener('click', function() {
                const bankId = this.dataset.bank;
                openBankApp(bankId);
            });
        });
    </script>
</body>
</html>
